<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cr√©er une Annonce - Petites Annonces</title>
     <link rel="stylesheet" href="annonces.component.css">
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <nav class="navbar">
            <div class="logo">
                <h1>üì¢ Petites Annonces</h1>
            </div>
            <div class="nav-links">
                <a href="dashboard.html">‚Üê Retour au tableau de bord</a>
                <a href="index.html">Accueil</a>
            </div>
        </nav>
    </header>

    <!-- MAIN CONTAINER -->
    <div class="container">
        <!-- PAGE HEADER -->
        <div class="page-header">
            <h1 class="page-title">Cr√©er une nouvelle annonce</h1>
            <p class="page-subtitle">Remplissez les informations ci-dessous pour publier votre annonce</p>
        </div>

        <!-- ALERT -->
        <div id="alert" class="alert"></div>

        <!-- FORM CARD -->
        <div class="form-card">
            <form id="annonceForm">
                <!-- SECTION 1: INFORMATIONS G√âN√âRALES -->
                <div class="form-section">
                    <h2 class="section-title">
                        <span>üìã</span>
                        <span>Informations g√©n√©rales</span>
                    </h2>
                    <div class="section-divider"></div>
                    
                    <div class="form-group">
                        <label>
                            Titre de l'annonce <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="titre" 
                            name="titre" 
                            placeholder="Ex: Appartement 2 pi√®ces √† louer - Centre ville"
                            required
                            maxlength="100">
                        <div class="char-counter">
                            <span id="titreCount">0</span>/100 caract√®res
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                Type d'annonce <span class="required">*</span>
                            </label>
                            <select id="type" name="type" required>
                                <option value="">S√©lectionnez un type</option>
                                <option value="vente">üè∑Ô∏è Vente</option>
                                <option value="location">üè† Location</option>
                                <option value="service">üõ†Ô∏è Service</option>
                                <option value="emploi">üíº Emploi</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>
                                Prix (FCFA)
                            </label>
                            <input 
                                type="number" 
                                id="prix" 
                                name="prix" 
                                placeholder="Ex: 50000"
                                min="0"
                                step="1000">
                            <small>Laissez vide si le prix est √† n√©gocier</small>
                        </div>
                    </div>
                </div>

                <!-- SECTION 2: DESCRIPTION -->
                <div class="form-section">
                    <h2 class="section-title">
                        <span>‚úçÔ∏è</span>
                        <span>Description d√©taill√©e</span>
                    </h2>
                    <div class="section-divider"></div>

                    <div class="form-group">
                        <label>
                            Description <span class="required">*</span>
                        </label>
                        <textarea 
                            id="description" 
                            name="description" 
                            placeholder="D√©crivez votre annonce en d√©tail : caract√©ristiques, √©tat, localisation, etc."
                            required
                            maxlength="1000"></textarea>
                        <div class="char-counter">
                            <span id="descriptionCount">0</span>/1000 caract√®res
                        </div>
                        <small>Soyez pr√©cis et honn√™te dans votre description</small>
                    </div>
                </div>

                <!-- SECTION 3: LOCALISATION ET CONTACT -->
                <div class="form-section">
                    <h2 class="section-title">
                        <span>üìç</span>
                        <span>Localisation et Contact</span>
                    </h2>
                    <div class="section-divider"></div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                Ville <span class="required">*</span>
                            </label>
                            <select id="ville" name="ville" required>
                                <option value="">S√©lectionnez une ville</option>
                                <option value="Bamenda">Bamenda</option>
                                <option value="Yaound√©">Yaound√©</option>
                                <option value="Douala">Douala</option>
                                <option value="Bafoussam">Bafoussam</option>
                                <option value="Garoua">Garoua</option>
                                <option value="Maroua">Maroua</option>
                                <option value="Ngaound√©r√©">Ngaound√©r√©</option>
                                <option value="Bertoua">Bertoua</option>
                                <option value="Buea">Buea</option>
                                <option value="Limbe">Limbe</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>
                                Quartier
                            </label>
                            <input 
                                type="text" 
                                id="quartier" 
                                name="quartier" 
                                placeholder="Ex: Nkwen, Bamendankwe">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                T√©l√©phone <span class="required">*</span>
                            </label>
                            <input 
                                type="tel" 
                                id="telephone" 
                                name="telephone" 
                                placeholder="+237 6XX XX XX XX"
                                required>
                        </div>

                        <div class="form-group">
                            <label>
                                Email (optionnel)
                            </label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email" 
                                placeholder="votre.email@exemple.com">
                        </div>
                    </div>
                </div>

                <!-- SECTION 4: IMAGES -->
                <div class="form-section">
                    <h2 class="section-title">
                        <span>üì∑</span>
                        <span>Photos de l'annonce</span>
                    </h2>
                    <p class="section-subtitle">
                        Ajoutez des photos de qualit√© pour attirer plus d'acheteurs
                    </p>
                    <div class="section-divider"></div>

                    <div class="image-upload-container" onclick="document.getElementById('imageInput').click()">
                        <div class="upload-icon">üì∏</div>
                        <h3 class="upload-title">Cliquez pour ajouter des photos</h3>
                        <p class="upload-text">ou glissez-d√©posez vos images ici</p>
                        <p class="upload-limit">Maximum 5 images ‚Ä¢ JPG, PNG (Max 5 MB chacune)</p>
                    </div>

                    <input 
                        type="file" 
                        id="imageInput" 
                        accept="image/jpeg,image/png,image/jpg" 
                        multiple
                        onchange="handleImageUpload(event)">

                    <div id="imagePreviewContainer" class="image-preview-grid"></div>
                    <div id="imageCount" class="image-count"></div>
                </div>

                <!-- FORM ACTIONS -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="window.history.back()">
                        <span>‚ùå</span>
                        <span>Annuler</span>
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <span>‚úÖ</span>
                        <span>Publier l'annonce</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Variables globales
        let uploadedImages = [];
        const MAX_IMAGES = 5;
        const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5 MB

        // Character counters
        document.getElementById('titre').addEventListener('input', function() {
            document.getElementById('titreCount').textContent = this.value.length;
        });

        document.getElementById('description').addEventListener('input', function() {
            document.getElementById('descriptionCount').textContent = this.value.length;
        });

        // Handle image upload
        function handleImageUpload(event) {
            const files = Array.from(event.target.files);
            
            if (uploadedImages.length + files.length > MAX_IMAGES) {
                showAlert('Vous ne pouvez ajouter que ' + MAX_IMAGES + ' images maximum', 'error');
                return;
            }

            files.forEach(file => {
                // Validate file size
                if (file.size > MAX_FILE_SIZE) {
                    showAlert('L\'image ' + file.name + ' est trop volumineuse (max 5 MB)', 'error');
                    return;
                }

                // Validate file type
                if (!file.type.match('image/jpeg') && !file.type.match('image/png') && !file.type.match('image/jpg')) {
                    showAlert('Seuls les fichiers JPG et PNG sont accept√©s', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImages.push({
                        data: e.target.result,
                        name: file.name
                    });
                    renderImagePreviews();
                };
                reader.readAsDataURL(file);
            });

            // Reset input
            event.target.value = '';
        }

        // Render image previews
        function renderImagePreviews() {
            const container = document.getElementById('imagePreviewContainer');
            const countContainer = document.getElementById('imageCount');

            if (uploadedImages.length === 0) {
                container.innerHTML = '';
                countContainer.innerHTML = '';
                return;
            }

            container.innerHTML = uploadedImages.map((img, index) => `
                <div class="image-preview-item">
                    <img src="${img.data}" alt="${img.name}">
                    <button type="button" class="remove-image-btn" onclick="removeImage(${index})">
                        ‚úï
                    </button>
                </div>
            `).join('');

            countContainer.innerHTML = `${uploadedImages.length}/${MAX_IMAGES} images ajout√©es`;
        }

        // Remove image
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            renderImagePreviews();
        }

        // Show alert
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = 'alert ' + type;
            
            setTimeout(() => {
                alert.className = 'alert';
            }, 5000);

            // Scroll to alert
            alert.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Handle form submission
        document.getElementById('annonceForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // Validate images
            if (uploadedImages.length === 0) {
                showAlert('Veuillez ajouter au moins une image', 'error');
                return;
            }

            // Get form data
            const formData = {
                id: Date.now(),
                titre: document.getElementById('titre').value,
                type: document.getElementById('type').value,
                prix: document.getElementById('prix').value,
                description: document.getElementById('description').value,
                ville: document.getElementById('ville').value,
                quartier: document.getElementById('quartier').value,
                telephone: document.getElementById('telephone').value,
                email: document.getElementById('email').value,
                images: uploadedImages.map(img => img.data),
                date: new Date().toISOString(),
                views: 0,
                statut: 'active'
            };

            // Save to localStorage
            let annonces = JSON.parse(localStorage.getItem('annonces')) || [];
            annonces.push(formData);
            localStorage.setItem('annonces', JSON.stringify(annonces));

            // Show success message
            showAlert('Annonce cr√©√©e avec succ√®s ! Redirection...', 'success');

            // Redirect after 2 seconds
            setTimeout(() => {
                window.location.href = 'dashboard.html';
            }, 2000);
        });

        // Drag and drop functionality
        const uploadContainer = document.querySelector('.image-upload-container');

        uploadContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadContainer.style.borderColor = 'var(--primary-color)';
            uploadContainer.style.backgroundColor = '#eff6ff';
        });

        uploadContainer.addEventListener('dragleave', () => {
            uploadContainer.style.borderColor = 'var(--border-color)';
            uploadContainer.style.backgroundColor = 'var(--light-color)';
        });

        uploadContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadContainer.style.borderColor = 'var(--border-color)';
            uploadContainer.style.backgroundColor = 'var(--light-color)';
            
            const files = e.dataTransfer.files;
            document.getElementById('imageInput').files = files;
            handleImageUpload({ target: { files: files } });
        });
    </script>
</body>
</html>