<header class="header">
  <nav class="navbar">
    <div class="logo">
      <img src="https://cdn-icons-png.flaticon.com/512/4538/4538836.png" alt="Logo" class="logo-icon">
      <h1>Petites Annonces</h1>
    </div>
    <div class="nav-links">
      <a routerLink="/dashboard" class="nav-link">
        <img src="https://cdn-icons-png.flaticon.com/512/3917/3917776.png" alt="Dashboard" class="nav-icon">
        <span>Tableau de bord</span>
      </a>
      <a routerLink="/" class="nav-link">
        <img src="https://cdn-icons-png.flaticon.com/512/1946/1946488.png" alt="Accueil" class="nav-icon">
        <span>Accueil</span>
      </a>
    </div>
  </nav>
</header>

<div class="container">
  <div class="page-header">
    <div class="page-header-icon">
      <img src="https://cdn-icons-png.flaticon.com/512/3176/3176366.png" alt="Create">
    </div>
    <h1 class="page-title">Créer une nouvelle annonce</h1>
    <p class="page-subtitle">Remplissez les informations ci-dessous pour publier votre annonce</p>
  </div>

  <!-- Alert -->
  <div *ngIf="showAlert" 
       class="alert animate-slide-in" 
       [class.success]="alertType === 'success'"
       [class.error]="alertType === 'error'"
       [class.animate-slide-out]="!showAlert">
    <img *ngIf="alertType === 'success'" 
         src="https://cdn-icons-png.flaticon.com/512/5610/5610944.png" 
         alt="Success" 
         class="alert-icon">
    <img *ngIf="alertType === 'error'" 
         src="https://cdn-icons-png.flaticon.com/512/6659/6659895.png" 
         alt="Error" 
         class="alert-icon">
    <span>{{ alertMessage }}</span>
  </div>

  <!-- Form Card -->
  <div class="form-card">
    <form [formGroup]="annonceForm" (ngSubmit)="onSubmit()">
      
      <!-- Section 1: Informations générales -->
      <div class="form-section">
        <h2 class="section-title">
          <img src="https://cdn-icons-png.flaticon.com/512/2541/2541988.png" alt="Info" class="section-icon">
          <span>Informations générales</span>
        </h2>
        <div class="section-divider"></div>
        
        <div class="form-group" [class.invalid]="isFieldInvalid('titre')">
          <label>
            Titre de l'annonce <span class="required">*</span>
          </label>
          <input 
            type="text" 
            formControlName="titre"
            placeholder="Ex: Appartement 2 pièces à louer - Centre ville"
            maxlength="100">
          <div class="char-counter">
            {{ titreCount }}/100 caractères
          </div>
          <div class="error-message" *ngIf="isFieldInvalid('titre')">
            {{ getErrorMessage('titre') }}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group" [class.invalid]="isFieldInvalid('type')">
            <label>
              Type d'annonce <span class="required">*</span>
            </label>
            <div class="select-wrapper">
              <select formControlName="type">
                <option value="">Sélectionnez un type</option>
                <option *ngFor="let type of typesAnnonce" [value]="type.value">
                  {{ type.label }}
                </option>
              </select>
              <img src="https://cdn-icons-png.flaticon.com/512/271/271239.png" alt="Arrow" class="select-arrow">
            </div>
            <div class="error-message" *ngIf="isFieldInvalid('type')">
              {{ getErrorMessage('type') }}
            </div>
          </div>

          <div class="form-group" [class.invalid]="isFieldInvalid('prix')">
            <label>
              <img src="https://cdn-icons-png.flaticon.com/512/2331/2331966.png" alt="Price" class="label-icon">
              Prix (FCFA)
            </label>
            <input 
              type="number" 
              formControlName="prix"
              placeholder="Ex: 50000"
              min="0"
              step="1000">
            <small>Laissez vide si le prix est à négocier</small>
            <div class="error-message" *ngIf="isFieldInvalid('prix')">
              {{ getErrorMessage('prix') }}
            </div>
          </div>
        </div>

        <!-- Type Cards Preview -->
        <div class="type-cards" *ngIf="annonceForm.get('type')?.value">
          <div class="type-card animate-fade-in" 
               *ngFor="let type of typesAnnonce" 
               [class.selected]="annonceForm.get('type')?.value === type.value">
            <img [src]="type.icon" [alt]="type.label" class="type-icon">
            <span>{{ type.label }}</span>
          </div>
        </div>
      </div>

      <!-- Section 2: Description -->
      <div class="form-section">
        <h2 class="section-title">
          <img src="https://cdn-icons-png.flaticon.com/512/2920/2920277.png" alt="Description" class="section-icon">
          <span>Description détaillée</span>
        </h2>
        <div class="section-divider"></div>

        <div class="form-group" [class.invalid]="isFieldInvalid('description')">
          <label>
            Description <span class="required">*</span>
          </label>
          <textarea 
            formControlName="description"
            placeholder="Décrivez votre annonce en détail : caractéristiques, état, localisation, etc."
            maxlength="1000"></textarea>
          <div class="char-counter">
            {{ descriptionCount }}/1000 caractères
          </div>
          <small>Soyez précis et honnête dans votre description</small>
          <div class="error-message" *ngIf="isFieldInvalid('description')">
            {{ getErrorMessage('description') }}
          </div>
        </div>
      </div>

      <!-- Section 3: Localisation et Contact -->
      <div class="form-section">
        <h2 class="section-title">
          <img src="https://cdn-icons-png.flaticon.com/512/684/684908.png" alt="Location" class="section-icon">
          <span>Localisation et Contact</span>
        </h2>
        <div class="section-divider"></div>

        <div class="form-row">
          <div class="form-group" [class.invalid]="isFieldInvalid('ville')">
            <label>
              Ville <span class="required">*</span>
            </label>
            <div class="select-wrapper">
              <select formControlName="ville">
                <option value="">Sélectionnez une ville</option>
                <option *ngFor="let ville of villes" [value]="ville">
                  {{ ville }}
                </option>
              </select>
              <img src="https://cdn-icons-png.flaticon.com/512/271/271239.png" alt="Arrow" class="select-arrow">
            </div>
            <div class="error-message" *ngIf="isFieldInvalid('ville')">
              {{ getErrorMessage('ville') }}
            </div>
          </div>

          <div class="form-group">
            <label>
              <img src="https://cdn-icons-png.flaticon.com/512/854/854901.png" alt="Neighborhood" class="label-icon">
              Quartier
            </label>
            <input 
              type="text" 
              formControlName="quartier"
              placeholder="Ex: Nkwen, Bamendankwe">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group" [class.invalid]="isFieldInvalid('telephone')">
            <label>
              <img src="https://cdn-icons-png.flaticon.com/512/724/724664.png" alt="Phone" class="label-icon">
              Téléphone <span class="required">*</span>
            </label>
            <input 
              type="tel" 
              formControlName="telephone"
              placeholder="+237 6XX XX XX XX">
            <div class="error-message" *ngIf="isFieldInvalid('telephone')">
              {{ getErrorMessage('telephone') }}
            </div>
          </div>

          <div class="form-group" [class.invalid]="isFieldInvalid('email')">
            <label>
              <img src="https://cdn-icons-png.flaticon.com/512/732/732200.png" alt="Email" class="label-icon">
              Email (optionnel)
            </label>
            <input 
              type="email" 
              formControlName="email"
              placeholder="votre.email@exemple.com">
            <div class="error-message" *ngIf="isFieldInvalid('email')">
              {{ getErrorMessage('email') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Section 4: Images -->
      <div class="form-section">
        <h2 class="section-title">
          <img src="https://cdn-icons-png.flaticon.com/512/3342/3342137.png" alt="Photos" class="section-icon">
          <span>Photos de l'annonce</span>
        </h2>
        <p class="section-subtitle">
          Ajoutez des photos de qualité pour attirer plus d'acheteurs
        </p>
        <div class="section-divider"></div>

        <div class="image-upload-container" 
             (click)="triggerFileInput()"
             (dragover)="onDragOver($event)"
             (dragleave)="onDragLeave($event)"
             (drop)="onDrop($event)">
          <img src="https://cdn-icons-png.flaticon.com/512/1160/1160358.png" alt="Upload" class="upload-icon">
          <h3 class="upload-title">Cliquez pour ajouter des photos</h3>
          <p class="upload-text">ou glissez-déposez vos images ici</p>
          <p class="upload-limit">Maximum 5 images • JPG, PNG, WEBP (Max 5 MB chacune)</p>
        </div>

        <input 
          type="file" 
          id="imageInput"
          accept="image/jpeg,image/png,image/jpg,image/webp" 
          multiple
          (change)="onFileSelected($event)"
          style="display: none;">

        <div class="image-preview-grid" *ngIf="uploadedImages.length > 0">
          <div class="image-preview-item animate-fade-in" 
               *ngFor="let img of uploadedImages; let i = index">
            <img [src]="img.data" [alt]="img.name">
            <div class="image-overlay">
              <span class="image-name">{{ img.name }}</span>
            </div>
            <button type="button" 
                    class="remove-image-btn" 
                    (click)="removeImage(i)"
                    title="Supprimer cette image">
              <img src="https://cdn-icons-png.flaticon.com/512/1828/1828778.png" alt="Remove">
            </button>
          </div>
        </div>

        <div class="image-count animate-fade-in" *ngIf="uploadedImages.length > 0">
          <img src="https://cdn-icons-png.flaticon.com/512/3342/3342137.png" alt="Images" class="count-icon">
          <span>{{ uploadedImages.length }}/{{ MAX_IMAGES }} images ajoutées</span>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="onCancel()" [disabled]="isSubmitting">
          <img src="https://cdn-icons-png.flaticon.com/512/1828/1828778.png" alt="Cancel" class="btn-icon">
          <span>Annuler</span>
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="isSubmitting">
          <img *ngIf="!isSubmitting" src="https://cdn-icons-png.flaticon.com/512/5610/5610944.png" alt="Publish" class="btn-icon">
          <div *ngIf="isSubmitting" class="spinner"></div>
          <span>{{ isSubmitting ? 'Publication...' : 'Publier l\'annonce' }}</span>
        </button>
      </div>
    </form>
  </div>
</div>